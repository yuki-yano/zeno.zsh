#!/usr/bin/env zsh

args=("$@")
deno_flags=(
  --unstable-byonm
  --no-check
  --allow-env
  --allow-read
  --allow-run
  --allow-write
)

# NOTE: Suppress --quiet when auto-snippet runs first because Deno's initial dependency downloads flood stderr,
#       which breaks the prompt and hides input until reset-prompt
quiet=0
for (( i = 1; i <= $#args; ++i )); do
  case ${args[i]} in
    --zeno-mode=auto-snippet)
      quiet=1
      break
      ;;
    --zeno-mode)
      if (( i + 1 <= $#args )) && [[ ${args[i+1]} == auto-snippet ]]; then
        quiet=1
        break
      fi
      ;;
  esac
done
(( quiet )) && deno_flags+=(--quiet)

exec deno run "${deno_flags[@]}" -- "${ZENO_ROOT:-${0:a:h:h}}/src/cli.ts" "${args[@]}"
