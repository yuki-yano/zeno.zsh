#autoload

emulate -L zsh

local input
local -a out tokens

tokens=( ${(z)LBUFFER} )

if [[ $#tokens == 1 ]]; then
  input=$(printf '%s\n%s' "$LBUFFER" "$RBUFFER")
  out=( "${(f)$(zeno-call-client-and-fallback 'auto-snippet' "$input")}" )

  if [[ $out[1] == success && -n $out[2] ]]; then
    BUFFER=$out[2]
  fi
fi

zle accept-line
