#autoload

emulate -L zsh

local input
local -a out

input=$(printf '%s\n%s' "$LBUFFER" "$RBUFFER")
out=( "${(f)$(zeno-call-client-and-fallback "auto-snippet" "$input")}" )

if [[ $out[1] != success ]]; then
  LBUFFER+=" "
  return
fi

if [[ -n $out[2] ]]; then
  BUFFER=$out[2]
  CURSOR=$out[3]
fi

zle reset-prompt
